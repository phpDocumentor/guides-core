{# Define a variable to store the classes #}
{% set tableClasses = '' %}

{# Check and add classes conditionally #}
{% if tableNode.classes %}
    {% set tableClasses = tableClasses ~ tableNode.classesString ~ ' ' %}
{% endif %}
{% if tableNode.hasOption('align') %}
    {% set tableClasses = tableClasses ~ 'align-' ~ tableNode.option('align') ~ ' ' %}
{% endif %}
{% if tableNode.hasOption('widths') %}
    {% set tableClasses = tableClasses ~ 'colwidths-' ~ tableNode.option('widths') ~ ' ' %}
{% endif %}
{% if tableNode.hasOption('grid') == 'grid' %}
    {% set tableClasses = tableClasses ~ 'grid-' ~ tableNode.option('grid') ~ ' ' %}
{% endif %}

{% set tableStyle = '' %}
{% if tableNode.hasOption('width') %}
    {% set tableStyle = tableStyle ~ 'width: ' ~ tableNode.option('width') ~ '; ' %}
{% endif %}

<table
        {%- if tableClasses|trim %} class="{{ tableClasses|trim }}"{% endif %}
        {%- if tableStyle|trim %} style="{{ tableStyle|trim }}"{% endif %}
>
    {% if tableNode.hasOption('caption') %}
        <caption>{{ tableNode.option('caption') }}</caption>
    {% endif %}
    {% if tableNode.columnWidth %}
        <colgroup>
            {% for width in tableNode.columnWidth %}
                {% if width<=0 %}
                    <col style="width: auto">
                {% else %}
                    <col style="width: {{ width }}%">
                {% endif %}
            {% endfor %}
        </colgroup>
    {% endif %}
    {% if tableHeaderRows is not empty %}
        <thead>
            {% for tableHeaderRow in tableHeaderRows %}
                <tr>
                    {% for column in tableHeaderRow.columns %}
                        <th{% if column.colspan > 1 %} colspan="{{ column.colspan }}"{% endif %}>
                           {%- for child in column.children -%}
                              {{- renderNode(child) -}}
                           {% endfor %}</th>
                    {% endfor %}
                </tr>
            {% endfor %}
        </thead>
    {% endif %}

    <tbody>
        {% for tableRow in tableRows %}
            <tr>
                {% for column in tableRow.columns %}
                <td{% if column.colSpan > 1 %} colspan="{{ column.colSpan }}"{% endif %}{% if column.rowSpan > 1 %} rowspan="{{ column.rowSpan }}"{% endif %}>
                    {%- for child in column.children -%}
                        {{- renderNode(child) -}}
                    {%- else %}&nbsp;{% endfor %}</td>
                {% endfor %}
            </tr>
        {% endfor %}
    </tbody>
</table>
